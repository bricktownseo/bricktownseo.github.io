"use strict";angular.module("SEMRushApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","blockUI"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/semrush-2nd-page.html",controller:"SEMRushCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("SEMRushApp").controller("MainCtrl",["$scope",function(a){}]),angular.module("SEMRushApp").controller("SEMRushCtrl",["$scope","blockUI","$http","$q",function(a,b,c,d){function e(d){var e="http://api.semrush.com/?type=phrase_fullsearch&phrase="+d+"&key="+a.semkey+"&display_limit=5&export_columns=Ph,Nq,Cp,Co,Nr,Td&database=us";c.get(e).success(function(b,c,d,e){a.keywords=h(b),a.searching=!1,a.complete=!0,f()}).error(function(a,c,d,e){console.log(a),b.stop()})}function f(){if(a.keywords.length>0)for(var d=0;d<a.keywords.length;d++){var e="http://api.semrush.com/?type=phrase_organic&key="+a.semkey+"&display_limit=20&export_columns=Dn,Ur&phrase="+a.keywords[d].Keyword+"&database=us";b.message("Checking domains for keyword "+a.keywords[d].Keyword+"..."),c.get(e).success(function(c,d,e,f){var i=f.url.substring(f.url.indexOf("phrase=")+7);i=i.substring(0,i.indexOf("&"));for(var j=h(c),k=10;k<j.length;k++)-1==a.domainArray.indexOf(j[k].Domain)?(a.domainArray.push(j[k].Domain),a.domains[j[k].Domain]={domain:j[k].Domain,position:"("+(k+1)+") "+i},g(j[k].Domain)):a.domains[j[k].Domain].position=a.domains[j[k].Domain].position+"\n ("+(k+1)+") "+i;for(var k=0;10>k&&k<j.length;k++)a.domainArray.indexOf(j[k].Domain)>=0&&(a.domains[j[k].Domain].position=a.domains[j[k].Domain].position+"\n ("+(k+1)+") "+i);console.log(a.domains),b.stop()}).error(function(a,c,d,e){console.log(a),b.stop()})}else b.stop(),a.error="We failed to do something right..."}function g(d){var e="http://api.semrush.com/?type=domain_adwords&key="+a.semkey+"&display_limit=10000&export_columns=Ph,Po,Pp,Pd,Nq,Cp,Vu,Tr,Tc,Co,Nr,Td&domain="+d+"&display_sort=po_asc&database=us";c.get(e,{domain:d}).success(function(b,c,d,e){var f=e.domain,g=h(b);g.length>0&&(a.domains[f].paid=g.length,a.domains[f].paiddetail=g)}).error(function(a,c,d,e){console.log(a),b.stop()})}function h(b){var c=[];if(b.includes("ERROR"))return console.log(b),a.status="Error checking the keyword",c;for(var d=b.split("\n"),e=[],f=0;f<d.length;f++){var g=d[f].split(";");if(0==f)e=g;else{for(var h={},i=0;i<e.length;i++)h[e[i]]=g[i];c.push(h)}}return c}a.keywords="",a.city="",a.semkey="",a.topKeyword={keyword:"",volume:0},a.domains={},a.domainArray=[],a.search=function(){a.searching=!0,b.start("Searching Domains..."),a.keywordsArr=[],a.status="Checking "+a.city+" "+a.keyword.trim()+"...";var c=encodeURIComponent(a.city+"+"+a.keyword.trim());e(c)},a.showData=function(b){a.selected=b,$("#paid_modal").openModal()},a.closeData=function(){$("#paid_modal").closeModal()}}]);